<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام إدارة البيانات</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --secondary: #3a0ca3;
      --accent: #7209b7;
      --success: #4cc9f0;
      --warning: #f72585;
      --dark: #212529;
      --light: #f8f9fa;
      --gray: #6c757d;
      --card-bg: #ffffff;
      --sidebar-bg: #2D3047;
      --gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
      --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      --radius: 12px;
      --transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    /* أنماط الوضع الليلي */
    body.dark-mode {
      --dark: #f8f9fa;
      --light: #121212;
      --gray: #adb5bd;
      --card-bg: #1e1e1e;
      --sidebar-bg: #2D3047;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      color: var(--dark);
    }
    
    body.dark-mode .header {
      background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
    }
    
    body.dark-mode .search-input {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    body.dark-mode .search-input:focus {
      background: rgba(255, 255, 255, 0.15);
    }
    
    body.dark-mode .form-section, 
    body.dark-mode .data-section,
    body.dark-mode .stat-card,
    body.dark-mode .info-box {
      background: #2a2a2a;
      color: var(--dark);
    }
    
    body.dark-mode input, 
    body.dark-mode textarea, 
    body.dark-mode select {
      background: #333;
      color: white;
      border-color: #444;
    }
    
    body.dark-mode .file-input-label {
      background: #333;
      border-color: #444;
      color: #ccc;
    }
    
    body.dark-mode .section-title {
      border-bottom-color: #444;
    }
    
    body.dark-mode .btn-outline {
      color: var(--primary-light);
      border-color: var(--primary-light);
    }
    
    body.dark-mode .btn-outline:hover {
      background: var(--primary-light);
      color: #121212;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Tajawal', sans-serif;
      line-height: 1.5;
      color: var(--dark);
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      min-height: 100vh;
      padding: 0;
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
      font-size: 14px;
    }
    
    /* الشريط العلوي - تصميم مخصص مع التركيز على البحث */
    .header {
      background: var(--gradient);
      color: white;
      padding: 12px 15px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
      gap: 15px;
    }
    
    /* تصميم محسّن لشريط البحث - أصبح العنصر الرئيسي */
    .header-search {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      max-width: 100%;
      position: relative;
    }
    
    .search-input-wrapper {
      flex: 1;
      position: relative;
    }
    
    .search-input {
      width: 100%;
      padding: 16px 50px 16px 20px;
      border: none;
      border-radius: 30px;
      font-size: 1.1rem;
      font-family: 'Tajawal', sans-serif;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      transition: var(--transition);
      background: rgba(255, 255, 255, 0.95);
      color: #333;
    }
    
    .search-input:focus {
      outline: none;
      box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
      transform: translateY(-2px);
      background: white;
    }
    
    .search-icon {
      position: absolute;
      right: 20px;
      left: auto;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary);
      font-size: 1.2rem;
    }
    
    /* زر البحث الصوتي - تصميم أكبر */
    .voice-search-btn {
      background: rgba(255, 255, 255, 0.25);
      border: none;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: blur(10px);
      font-size: 1.3rem;
      order: -1;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .voice-search-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: scale(1.08);
    }
    
    .voice-search-btn.listening {
      background: var(--warning);
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0.7); }
      70% { box-shadow: 0 0 0 12px rgba(247, 37, 133, 0); }
      100% { box-shadow: 0 0 0 0 rgba(247, 37, 133, 0); }
    }
    
    /* نتائج البحث التلقائي - تصميم محسّن */
    .search-results-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      left: 0;
      background: var(--card-bg);
      border-radius: 0 0 15px 15px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      max-height: 350px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
      margin-top: 8px;
      border: 1px solid #e1e5eb;
    }
    
    .search-results-dropdown.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .search-result-item {
      padding: 15px 20px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: var(--transition);
    }
    
    .search-result-item:hover {
      background: rgba(67, 97, 238, 0.1);
    }
    
    .search-result-item:last-child {
      border-bottom: none;
    }
    
    .search-result-image {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      object-fit: cover;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray);
      flex-shrink: 0;
      overflow: hidden;
      border: 1px solid #eaeaea;
    }
    
    .search-result-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .search-result-info {
      flex: 1;
    }
    
    .search-result-name {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 1.05rem;
      color: var(--dark);
    }
    
    .search-result-barcode {
      font-size: 0.95rem;
      color: #e6377c;
      background: rgba(230, 55, 124, 0.1);
      padding: 5px 10px;
      border-radius: 6px;
      display: inline-block;
      font-weight: 600;
      border: 1px solid rgba(230, 55, 124, 0.2);
    }
    
    .search-result-category {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 6px;
    }
    
    .search-highlight {
      background-color: #ffeb3b;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 700;
      color: #000;
    }
    
    body.dark-mode .search-highlight {
      background-color: #ffeb3b;
      color: #000;
    }
    
    .header-nav {
      display: flex;
      gap: 10px;
      align-items: center;
      flex: 0 0 auto;
      justify-content: flex-end;
    }
    
    .nav-icon {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: blur(10px);
      font-size: 1.2rem;
      position: relative;
    }
    
    .nav-icon:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.08);
    }
    
    .nav-icon.active {
      background: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
    }
    
    .nav-tooltip {
      position: absolute;
      bottom: -40px;
      right: 50%;
      transform: translateX(50%);
      background: var(--dark);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      z-index: 10;
    }
    
    .nav-tooltip::after {
      content: '';
      position: absolute;
      top: -4px;
      right: 50%;
      transform: translateX(50%);
      border-width: 0 4px 4px 4px;
      border-style: solid;
      border-color: transparent transparent var(--dark) transparent;
    }
    
    .nav-icon:hover .nav-tooltip {
      opacity: 1;
      visibility: visible;
    }
    
    /* المحتوى الرئيسي */
    .main-content {
      padding: 25px 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* محتوى التبويبات */
    .tab-content {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* الأقسام الرئيسية */
    .content-sections {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 25px;
    }
    
    @media (max-width: 1200px) {
      .content-sections {
        grid-template-columns: 1fr;
      }
    }
    
    .form-section, .data-section {
      background: var(--card-bg);
      padding: 25px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    .form-section:hover, .data-section:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
    }
    
    .section-title {
      font-size: 1.3rem;
      color: var(--dark);
      margin-bottom: 25px;
      padding-bottom: 12px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title i {
      color: var(--primary);
    }
    
    /* النماذج */
    .form-group {
      margin-bottom: 18px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
      font-size: 1rem;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid #e1e5eb;
      border-radius: 10px;
      font-family: 'Tajawal', sans-serif;
      font-size: 1rem;
      transition: var(--transition);
      background: #f8f9fa;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      background: white;
    }
    
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    button {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-family: 'Tajawal', sans-serif;
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--warning), #e6377c);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success), #3a9cdf);
    }
    
    .btn-outline {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    
    .btn-group button {
      flex: 1;
      min-width: 140px;
    }
    
    /* عرض البيانات */
    .data-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    /* عرض المنتجات كبطاقات */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }
    
    .product-card {
      border-radius: var(--radius);
      padding: 25px;
      transition: var(--transition);
      background: var(--card-bg);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    
    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 5px;
      background: var(--gradient);
      transform: scaleX(0);
      transition: var(--transition);
    }
    
    .product-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }
    
    .product-card:hover::before {
      transform: scaleX(1);
    }
    
    .product-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 18px;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray);
      transition: var(--transition);
      overflow: hidden;
    }
    
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .product-card:hover .product-image {
      transform: scale(1.04);
    }
    
    .product-name {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--dark);
    }
    
    .product-barcode {
      font-size: 1rem;
      color: #e6377c;
      background: rgba(230, 55, 124, 0.1);
      padding: 6px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      display: inline-block;
      font-weight: 600;
      border: 1px solid rgba(230, 55, 124, 0.2);
    }
    
    .product-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 18px;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .product-category {
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .product-actions {
      display: flex;
      gap: 10px;
    }
    
    .product-actions button {
      padding: 10px 14px;
      font-size: 0.9rem;
      flex: 1;
    }
    
    /* معاينة الصور */
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }
    
    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-input-label {
      display: block;
      padding: 14px;
      background: #f8f9fa;
      border: 2px dashed #e1e5eb;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .file-input-label:hover {
      background: #e9ecef;
      border-color: var(--primary);
    }
    
    .preview-image {
      max-width: 100%;
      max-height: 180px;
      margin-top: 12px;
      border-radius: 10px;
      display: none;
      border: 1px solid #e1e5eb;
      transition: var(--transition);
    }
    
    .preview-image:hover {
      transform: scale(1.03);
    }
    
    /* زر الكاميرا */
    .camera-btn {
      background: linear-gradient(135deg, #4cc9f0, #3a9cdf);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-family: 'Tajawal', sans-serif;
      width: 100%;
      margin-top: 12px;
    }
    
    .camera-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(76, 201, 240, 0.4);
    }
    
    /* نافذة الكاميرا */
    .camera-modal {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .camera-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .camera-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 25px;
      max-width: 90%;
      max-height: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }
    
    .camera-preview {
      width: 100%;
      max-width: 550px;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .camera-actions {
      display: flex;
      gap: 12px;
    }
    
    /* نافذة عرض تفاصيل المنتج */
    .product-details-modal {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .product-details-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .product-details-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 30px;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      width: 550px;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    
    .product-details-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 10px;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray);
      overflow: hidden;
    }
    
    .product-details-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }
    
    .product-details-info {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .product-details-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .product-details-label {
      font-weight: 600;
      color: var(--primary);
    }
    
    .product-details-value {
      color: var(--dark);
    }
    
    .product-details-actions {
      display: flex;
      gap: 12px;
      margin-top: 18px;
    }
    
    .product-details-actions button {
      flex: 1;
    }
    
    /* نافذة حذف جميع البيانات */
    .delete-all-modal {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .delete-all-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .delete-all-container {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 30px;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      width: 500px;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    
    /* حالة فارغة */
    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--gray);
      grid-column: 1 / -1;
    }
    
    .empty-state i {
      font-size: 3.5rem;
      margin-bottom: 18px;
      color: #e1e5eb;
    }
    
    .empty-state h3 {
      margin-bottom: 12px;
      color: var(--gray);
      font-size: 1.3rem;
    }
    
    /* الإشعارات */
    .notification {
      position: fixed;
      bottom: 25px;
      left: 25px;
      right: 25px;
      padding: 18px 25px;
      background: var(--card-bg);
      color: var(--dark);
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      transform: translateY(120px);
      opacity: 0;
      transition: var(--transition);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 12px;
      border-right: 5px solid var(--primary);
      max-width: 500px;
      margin: 0 auto;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification.success {
      border-right-color: var(--success);
    }
    
    .notification.warning {
      border-right-color: var(--warning);
    }
    
    .notification.info {
      border-right-color: var(--primary);
    }
    
    /* صندوق المعلومات */
    .info-box {
      background: var(--card-bg);
      padding: 18px;
      border-radius: 10px;
      margin-top: 30px;
    }
    
    .info-box p {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
    }
    
    .info-box strong {
      color: var(--primary);
    }
    
    /* التجاوب مع الشاشات الصغيرة */
    @media (max-width: 1024px) {
      .header-content {
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .header-search {
        order: 3;
        width: 100%;
        max-width: 100%;
      }
      
      .header-nav {
        order: 2;
      }
    }
    
    @media (max-width: 768px) {
      .header {
        padding: 10px 15px;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
      }
      
      .content-sections {
        grid-template-columns: 1fr;
      }
      
      .nav-icon, .voice-search-btn {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
      }
      
      .search-results-dropdown {
        max-height: 300px;
      }
      
      .search-input {
        padding: 14px 45px 14px 15px;
        font-size: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .header-search {
        flex-direction: row;
        gap: 10px;
      }
      
      .header-nav {
        width: 100%;
        justify-content: space-between;
        order: 3;
        margin-top: 10px;
      }
      
      .search-input {
        padding: 12px 40px 12px 15px;
        font-size: 0.95rem;
      }
      
      .voice-search-btn {
        width: 50px;
        height: 50px;
      }
    }
  </style>
</head>
<body>
  <!-- الشريط العلوي - تصميم مخصص مع التركيز على البحث -->
  <header class="header">
    <div class="header-content">
      <!-- تم إزالة الشعار والأيقونة بالكامل -->
      
      <div class="header-search">
        <div class="search-input-wrapper">
          <input type="text" id="search-input" class="search-input" placeholder="ابحث في المنتجات أو الباركود...">
          <i class="fas fa-search search-icon"></i>
          
          <!-- نتائج البحث التلقائي -->
          <div class="search-results-dropdown" id="search-results-dropdown">
            <!-- سيتم ملؤها ديناميكياً -->
          </div>
        </div>
        
        <!-- زر البحث الصوتي - تصميم أكبر -->
        <button class="voice-search-btn" id="voice-search-btn" title="البحث الصوتي">
          <i class="fas fa-microphone"></i>
        </button>
      </div>
      
      <div class="header-nav">
        <button class="nav-icon" id="nav-products" data-tab="products">
          <i class="fas fa-boxes"></i>
          <div class="nav-tooltip">جميع المنتجات</div>
        </button>
        
        <button class="nav-icon" id="nav-categories" data-tab="categories">
          <i class="fas fa-tags"></i>
          <div class="nav-tooltip">إدارة الفئات</div>
        </button>
        
        <button class="nav-icon" id="nav-add-product" data-tab="add-product">
          <i class="fas fa-plus-circle"></i>
          <div class="nav-tooltip">إضافة منتج جديد</div>
        </button>
        
        <button class="nav-icon" id="nav-settings" data-tab="settings">
          <i class="fas fa-cog"></i>
          <div class="nav-tooltip">الإعدادات</div>
        </button>
      </div>
    </div>
  </header>

  <!-- المحتوى الرئيسي -->
  <main class="main-content">
    <div class="tab-content active" id="products">
      <h2 class="section-title"><i class="fas fa-boxes"></i> جميع المنتجات</h2>
      
      <div class="data-actions">
        <div class="filters">
          <select id="category-filter">
            <option value="all">جميع الفئات</option>
            <!-- سيتم ملء الفئات ديناميكياً -->
          </select>
          
          <select id="sort-by">
            <option value="newest">الأحدث أولاً</option>
            <option value="oldest">الأقدم أولاً</option>
            <option value="name">حسب الاسم</option>
          </select>
        </div>
        
        <div class="btn-group">
          <button id="export-data" class="btn-outline">
            <i class="fas fa-file-export"></i> تصدير البيانات
          </button>
        </div>
      </div>
      
      <!-- عرض المنتجات كبطاقات -->
      <div class="products-grid" id="products-container">
        <!-- سيتم ملء هذا القسم بالمنتجات ديناميكياً -->
      </div>
    </div>
    
    <div class="tab-content" id="categories">
      <h2 class="section-title"><i class="fas fa-tags"></i> إدارة الفئات</h2>
      
      <div class="form-section">
        <div class="form-group">
          <label for="new-category-name"><i class="fas fa-tag"></i> اسم الفئة</label>
          <input type="text" id="new-category-name" placeholder="أدخل اسم الفئة">
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-image"></i> صورة الفئة (اختياري)</label>
          <div class="file-input-wrapper">
            <input type="file" id="category-image" accept="image/*">
            <div class="file-input-label">
              <i class="fas fa-cloud-upload-alt"></i> اختر صورة للفئة
            </div>
          </div>
          <img id="category-image-preview" class="preview-image" alt="معاينة صورة الفئة">
        </div>
        
        <div class="form-group">
          <label for="category-image-url"><i class="fas fa-link"></i> أو رابط الصورة</label>
          <input type="text" id="category-image-url" placeholder="أدخل رابط الصورة">
          <button type="button" id="load-category-image-url" class="btn-outline" style="margin-top: 10px; width: 100%;">
            <i class="fas fa-download"></i> تحميل الصورة من الرابط
          </button>
        </div>
        
        <button id="add-category-btn" class="btn-success">
          <i class="fas fa-plus"></i> إضافة الفئة
        </button>
      </div>
      
      <div class="section-title"><i class="fas fa-list"></i> الفئات الحالية</div>
      
      <div class="products-grid" id="categories-list">
        <!-- سيتم ملء الفئات ديناميكياً -->
      </div>
    </div>
    
    <div class="tab-content" id="add-product">
      <h2 class="section-title"><i class="fas fa-plus-circle"></i> إضافة منتج جديد</h2>
      
      <div class="content-sections">
        <section class="form-section">
          <div class="form-group">
            <label for="product-name"><i class="fas fa-tag"></i> اسم المنتج</label>
            <input type="text" id="product-name" placeholder="أدخل اسم المنتج">
          </div>
          
          <div class="form-group">
            <label for="product-category"><i class="fas fa-folder"></i> الفئة</label>
            <select id="product-category">
              <!-- سيتم ملء الفئات ديناميكياً -->
            </select>
          </div>
          
          <div class="form-group">
            <label for="product-barcode"><i class="fas fa-barcode"></i> رقم الباركود</label>
            <input type="text" id="product-barcode" placeholder="أدخل رقم الباركود">
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-image"></i> صورة المنتج</label>
            <div class="file-input-wrapper">
              <input type="file" id="product-image" accept="image/*">
              <div class="file-input-label">
                <i class="fas fa-cloud-upload-alt"></i> اختر صورة للمنتج
              </div>
            </div>
            
            <button type="button" id="open-camera" class="camera-btn">
              <i class="fas fa-camera"></i> التقاط صورة من الكاميرا
            </button>
            
            <div class="form-group" style="margin-top: 18px;">
              <label for="product-image-url"><i class="fas fa-link"></i> أو رابط الصورة</label>
              <input type="text" id="product-image-url" placeholder="أدخل رابط الصورة">
              <button type="button" id="load-product-image-url" class="btn-outline" style="margin-top: 10px; width: 100%;">
                <i class="fas fa-download"></i> تحميل الصورة من الرابط
              </button>
            </div>
            
            <img id="image-preview" class="preview-image" alt="معاينة الصورة">
          </div>
          
          <button id="save-product" class="btn-success">
            <i class="fas fa-save"></i> حفظ المنتج
          </button>
        </section>
        
        <section class="data-section">
          <h3 class="section-title"><i class="fas fa-history"></i> أحدث المنتجات المضافة</h3>
          <div id="recent-added-products">
            <!-- سيتم ملء هذا القسم بالمنتجات المضافة حديثاً -->
          </div>
        </section>
      </div>
    </div>
    
    <div class="tab-content" id="settings">
      <h2 class="section-title"><i class="fas fa-cog"></i> الإعدادات</h2>
      
      <div class="content-sections">
        <section class="form-section">
          <h3 class="section-title"><i class="fas fa-sliders-h"></i> إعدادات التطبيق</h3>
          
          <div class="form-group">
            <label for="dark-mode-toggle">الوضع الليلي</label>
            <div class="btn-group">
              <button id="dark-mode-toggle" class="btn-outline">
                <i class="fas fa-moon"></i> تفعيل الوضع الليلي
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label for="notifications-toggle">الإشعارات</label>
            <div class="btn-group">
              <button id="notifications-toggle" class="btn-outline">
                <i class="fas fa-bell"></i> تفعيل الإشعارات
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label for="auto-backup-toggle">النسخ الاحتياطي التلقائي</label>
            <div class="btn-group">
              <button id="auto-backup-toggle" class="btn-outline">
                <i class="fas fa-save"></i> تفعيل النسخ التلقائي
              </button>
            </div>
          </div>
        </section>
        
        <section class="data-section">
          <h3 class="section-title"><i class="fas fa-database"></i> إدارة البيانات</h3>
          
          <div class="btn-group">
            <button id="export-all-data" class="btn-outline">
              <i class="fas fa-file-export"></i> تصدير جميع البيانات
            </button>
            <button id="import-data" class="btn-outline">
              <i class="fas fa-file-import"></i> استيراد البيانات
            </button>
            <input type="file" id="import-file" accept=".json" style="display: none;">
          </div>
          
          <div class="form-group">
            <label>حذف جميع البيانات</label>
            <div class="btn-group">
              <button id="delete-all-data" class="btn-danger">
                <i class="fas fa-trash-alt"></i> حذف جميع البيانات
              </button>
            </div>
          </div>
          
          <div class="info-box">
            <h3 class="section-title"><i class="fas fa-info-circle"></i> معلومات التطبيق</h3>
            <p><strong>الإصدار:</strong> <span>2.4.0</span></p>
            <p><strong>تاريخ التحديث:</strong> <span id="app-update-date">١٥‏/١١‏/٢٠٢٥</span></p>
            <p><strong>حجم البيانات:</strong> <span id="total-data-size">0.00 KB</span></p>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- نافذة الكاميرا -->
  <div class="camera-modal" id="camera-modal">
    <div class="camera-container">
      <h3 style="margin-bottom: 18px;">التقاط صورة من الكاميرا</h3>
      <video id="camera-preview" class="camera-preview" autoplay playsinline></video>
      <canvas id="camera-canvas" style="display: none;"></canvas>
      <div class="camera-actions">
        <button id="capture-btn" class="btn-success">
          <i class="fas fa-camera"></i> التقاط
        </button>
        <button id="close-camera" class="btn-danger">
          <i class="fas fa-times"></i> إغلاق
        </button>
      </div>
    </div>
  </div>

  <!-- نافذة عرض تفاصيل المنتج -->
  <div class="product-details-modal" id="product-details-modal">
    <div class="product-details-container">
      <h2 class="section-title"><i class="fas fa-info-circle"></i> تفاصيل المنتج</h2>
      
      <div class="product-details-image" id="product-details-image">
        <i class="fas fa-box" style="font-size: 3.5rem;"></i>
      </div>
      
      <div class="product-details-info">
        <div class="product-details-row">
          <div class="product-details-label">اسم المنتج:</div>
          <div class="product-details-value" id="product-details-name">-</div>
        </div>
        
        <div class="product-details-row">
          <div class="product-details-label">الفئة:</div>
          <div class="product-details-value" id="product-details-category">-</div>
        </div>
        
        <div class="product-details-row">
          <div class="product-details-label">رقم الباركود:</div>
          <div class="product-details-value" id="product-details-barcode">-</div>
        </div>
      </div>
      
      <div class="product-details-actions">
        <button id="edit-product-details" class="btn-outline">
          <i class="fas fa-edit"></i> تعديل
        </button>
        <button id="close-product-details" class="btn-danger">
          <i class="fas fa-times"></i> إغلاق
        </button>
      </div>
    </div>
  </div>

  <!-- نافذة حذف جميع البيانات -->
  <div class="delete-all-modal" id="delete-all-modal">
    <div class="delete-all-container">
      <h2 class="section-title"><i class="fas fa-exclamation-triangle"></i> حذف جميع البيانات</h2>
      
      <div class="form-group">
        <label for="admin-password"><i class="fas fa-lock"></i> كلمة المرور (admin)</label>
        <input type="password" id="admin-password" placeholder="أدخل كلمة المرور">
      </div>
      
      <div class="product-details-actions">
        <button id="confirm-delete-all" class="btn-danger">
          <i class="fas fa-trash-alt"></i> تأكيد الحذف
        </button>
        <button id="cancel-delete-all" class="btn-outline">
          <i class="fas fa-times"></i> إلغاء
        </button>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-info-circle"></i>
    <span id="notification-text"></span>
  </div>

  <script>
    // متغيرات التطبيق
    let products = JSON.parse(localStorage.getItem('products')) || [];
    let categories = JSON.parse(localStorage.getItem('categories')) || [];
    let appSettings = JSON.parse(localStorage.getItem('appSettings')) || {
      darkMode: false,
      notifications: true,
      autoBackup: false,
      itemsPerPage: 20,
      defaultSort: 'newest'
    };
    
    let editingId = null;
    let editingCategoryId = null;
    let searchTimeout = null;
    let recognition = null;
    let cameraStream = null;

    // عناصر DOM
    const navIcons = document.querySelectorAll('.nav-icon');
    const tabContents = document.querySelectorAll('.tab-content');
    
    const productNameInput = document.getElementById('product-name');
    const productCategoryInput = document.getElementById('product-category');
    const productBarcodeInput = document.getElementById('product-barcode');
    const productImageInput = document.getElementById('product-image');
    const productImageUrlInput = document.getElementById('product-image-url');
    const loadProductImageUrlBtn = document.getElementById('load-product-image-url');
    const imagePreview = document.getElementById('image-preview');
    const saveProductBtn = document.getElementById('save-product');
    const productsContainer = document.getElementById('products-container');
    const recentAddedProductsContainer = document.getElementById('recent-added-products');
    const searchInput = document.getElementById('search-input');
    const searchResultsDropdown = document.getElementById('search-results-dropdown');
    const categoryFilter = document.getElementById('category-filter');
    const sortBy = document.getElementById('sort-by');
    const exportDataBtn = document.getElementById('export-data');
    const importDataBtn = document.getElementById('import-data');
    const importFileInput = document.getElementById('import-file');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    const voiceSearchBtn = document.getElementById('voice-search-btn');
    
    // عناصر الكاميرا
    const openCameraBtn = document.getElementById('open-camera');
    const cameraModal = document.getElementById('camera-modal');
    const cameraPreview = document.getElementById('camera-preview');
    const cameraCanvas = document.getElementById('camera-canvas');
    const captureBtn = document.getElementById('capture-btn');
    const closeCameraBtn = document.getElementById('close-camera');
    
    // عناصر الإعدادات
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const notificationsToggle = document.getElementById('notifications-toggle');
    const autoBackupToggle = document.getElementById('auto-backup-toggle');
    const exportAllDataBtn = document.getElementById('export-all-data');
    const deleteAllDataBtn = document.getElementById('delete-all-data');
    const appUpdateDateEl = document.getElementById('app-update-date');
    const totalDataSizeEl = document.getElementById('total-data-size');
    
    // عناصر نافذة عرض تفاصيل المنتج
    const productDetailsModal = document.getElementById('product-details-modal');
    const productDetailsImage = document.getElementById('product-details-image');
    const productDetailsName = document.getElementById('product-details-name');
    const productDetailsCategory = document.getElementById('product-details-category');
    const productDetailsBarcode = document.getElementById('product-details-barcode');
    const editProductDetailsBtn = document.getElementById('edit-product-details');
    const closeProductDetailsBtn = document.getElementById('close-product-details');
    
    // عناصر نافذة حذف جميع البيانات
    const deleteAllModal = document.getElementById('delete-all-modal');
    const adminPasswordInput = document.getElementById('admin-password');
    const confirmDeleteAllBtn = document.getElementById('confirm-delete-all');
    const cancelDeleteAllBtn = document.getElementById('cancel-delete-all');
    
    // عناصر إدارة الفئات
    const newCategoryNameInput = document.getElementById('new-category-name');
    const addCategoryBtn = document.getElementById('add-category-btn');
    const categoryImageInput = document.getElementById('category-image');
    const categoryImageUrlInput = document.getElementById('category-image-url');
    const loadCategoryImageUrlBtn = document.getElementById('load-category-image-url');
    const categoryImagePreview = document.getElementById('category-image-preview');
    const categoriesList = document.getElementById('categories-list');

    // أحداث
    document.addEventListener('DOMContentLoaded', initApp);
    navIcons.forEach(icon => icon.addEventListener('click', switchTab));
    saveProductBtn.addEventListener('click', saveProduct);
    productImageInput.addEventListener('change', previewImage);
    loadProductImageUrlBtn.addEventListener('click', loadImageFromUrl);
    searchInput.addEventListener('input', handleSearch);
    searchInput.addEventListener('focus', showSearchDropdown);
    searchInput.addEventListener('blur', hideSearchDropdown);
    categoryFilter.addEventListener('change', filterProducts);
    sortBy.addEventListener('change', filterProducts);
    exportDataBtn.addEventListener('click', exportData);
    importDataBtn.addEventListener('click', () => importFileInput.click());
    importFileInput.addEventListener('change', importData);
    voiceSearchBtn.addEventListener('click', toggleVoiceSearch);
    
    // أحداث الكاميرا
    openCameraBtn.addEventListener('click', openCamera);
    captureBtn.addEventListener('click', captureImage);
    closeCameraBtn.addEventListener('click', closeCamera);
    
    // أحداث الإعدادات
    darkModeToggle.addEventListener('click', toggleDarkMode);
    notificationsToggle.addEventListener('click', toggleNotifications);
    autoBackupToggle.addEventListener('click', toggleAutoBackup);
    exportAllDataBtn.addEventListener('click', exportAllData);
    deleteAllDataBtn.addEventListener('click', showDeleteAllModal);
    
    // أحداث نافذة حذف جميع البيانات
    confirmDeleteAllBtn.addEventListener('click', confirmDeleteAll);
    cancelDeleteAllBtn.addEventListener('click', cancelDeleteAll);
    
    // أحداث نافذة عرض تفاصيل المنتج
    editProductDetailsBtn.addEventListener('click', editProductFromDetails);
    closeProductDetailsBtn.addEventListener('click', closeProductDetails);
    
    // أحداث إدارة الفئات
    addCategoryBtn.addEventListener('click', addCategory);
    categoryImageInput.addEventListener('change', previewCategoryImage);
    loadCategoryImageUrlBtn.addEventListener('click', loadCategoryImageFromUrl);

    // تهيئة التطبيق
    function initApp() {
      initVoiceRecognition();
      updateCategories();
      renderProducts();
      renderRecentAddedProducts();
      loadSettings();
      updateProductCounts();
      renderCategories();
      
      // تطبيق الوضع الليلي إذا كان مفعلاً
      if (appSettings.darkMode) {
        document.body.classList.add('dark-mode');
      }
      
      // تحديث معلومات التطبيق
      updateAppInfo();
    }

    // عرض نتائج البحث التلقائي
    function showSearchDropdown() {
      if (searchInput.value.trim()) {
        searchResultsDropdown.classList.add('active');
      }
    }

    // إخفاء نتائج البحث التلقائي
    function hideSearchDropdown() {
      setTimeout(() => {
        searchResultsDropdown.classList.remove('active');
      }, 200);
    }

    // عرض نتائج البحث التلقائي
    function renderSearchResults(results) {
      if (results.length === 0) {
        searchResultsDropdown.innerHTML = `
          <div class="search-result-item" style="justify-content: center; color: var(--gray);">
            <i class="fas fa-search"></i> لا توجد نتائج
          </div>
        `;
        return;
      }

      searchResultsDropdown.innerHTML = results.slice(0, 5).map(product => {
        const category = categories.find(c => c.id === product.category);
        const categoryName = category ? category.name : 'غير معروف';
        
        return `
        <div class="search-result-item" data-id="${product.id}">
          <div class="search-result-image">
            ${product.image ? `<img src="${product.image}" alt="${product.name}">` : 
            `<i class="fas fa-box"></i>`}
          </div>
          <div class="search-result-info">
            <div class="search-result-name">${highlightSearchTerms(product.name)}</div>
            <div class="search-result-barcode">${product.barcode || 'غير محدد'}</div>
            <div class="search-result-category">${categoryName}</div>
          </div>
        </div>
      `}).join('');
      
      // إضافة أحداث النقر على النتائج
      document.querySelectorAll('.search-result-item').forEach(item => {
        if (item.dataset.id) {
          item.addEventListener('click', () => {
            showProductDetails(item.dataset.id);
            searchResultsDropdown.classList.remove('active');
            searchInput.value = '';
          });
        }
      });
    }

    // عرض تفاصيل المنتج
    function showProductDetails(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      
      // تعبئة البيانات في النافذة
      productDetailsName.textContent = product.name;
      
      const category = categories.find(c => c.id === product.category);
      productDetailsCategory.textContent = category ? category.name : 'غير معروف';
      
      productDetailsBarcode.textContent = product.barcode || 'غير محدد';
      
      // عرض الصورة
      if (product.image) {
        productDetailsImage.innerHTML = `<img src="${product.image}" alt="${product.name}">`;
      } else {
        productDetailsImage.innerHTML = '<i class="fas fa-box" style="font-size: 3.5rem;"></i>';
      }
      
      // تعيين معرف المنتج الحالي
      productDetailsModal.currentProductId = id;
      
      // عرض النافذة
      productDetailsModal.classList.add('active');
    }

    // إغلاق نافذة عرض تفاصيل المنتج
    function closeProductDetails() {
      productDetailsModal.classList.remove('active');
    }

    // تعديل المنتج من نافذة التفاصيل
    function editProductFromDetails() {
      const productId = productDetailsModal.currentProductId;
      if (productId) {
        editProduct(productId);
        closeProductDetails();
      }
    }

    // تهيئة نظام التعرف على الصوت
    function initVoiceRecognition() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'ar-SA';

        recognition.onstart = function() {
          voiceSearchBtn.classList.add('listening');
          voiceSearchBtn.innerHTML = '<i class="fas fa-stop"></i>';
          showNotification('جاري الاستماع... تحدث الآن', 'info');
        };

        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          searchInput.value = transcript;
          handleSearch();
          showNotification(`تم التعرف على: "${transcript}"`, 'success');
        };

        recognition.onerror = function(event) {
          console.error('خطأ في التعرف على الصوت:', event.error);
          showNotification('حدث خطأ في التعرف على الصوت. حاول مرة أخرى.', 'warning');
        };

        recognition.onend = function() {
          voiceSearchBtn.classList.remove('listening');
          voiceSearchBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        };
      } else {
        showNotification('المتصفح لا يدعم التعرف على الصوت', 'warning');
        voiceSearchBtn.style.display = 'none';
      }
    }

    // تفعيل/إلغاء البحث الصوتي
    function toggleVoiceSearch() {
      if (!recognition) {
        showNotification('نظام التعرف على الصوت غير متاح', 'warning');
        return;
      }

      try {
        if (voiceSearchBtn.classList.contains('listening')) {
          recognition.stop();
        } else {
          recognition.start();
        }
      } catch (error) {
        console.error('خطأ في التحكم بالتعرف على الصوت:', error);
        showNotification('حدث خطأ في تفعيل البحث الصوتي', 'warning');
      }
    }

    // فتح الكاميرا (استخدام الكاميرا الخلفية)
    function openCamera() {
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        // استخدام الكاميرا الخلفية (environment) بدلاً من الأمامية (user)
        const constraints = {
          video: { 
            facingMode: { exact: "environment" } // استخدام الكاميرا الخلفية
          }
        };
        
        navigator.mediaDevices.getUserMedia(constraints)
          .then(function(stream) {
            cameraStream = stream;
            cameraPreview.srcObject = stream;
            cameraModal.classList.add('active');
          })
          .catch(function(error) {
            // إذا فشل استخدام الكاميرا الخلفية، نستخدم الكاميرا الافتراضية
            console.warn('تعذر الوصول إلى الكاميرا الخلفية، جارٍ استخدام الكاميرا الافتراضية:', error);
            
            navigator.mediaDevices.getUserMedia({ video: true })
              .then(function(stream) {
                cameraStream = stream;
                cameraPreview.srcObject = stream;
                cameraModal.classList.add('active');
              })
              .catch(function(error) {
                showNotification('تعذر الوصول إلى الكاميرا: ' + error.message, 'warning');
              });
          });
      } else {
        showNotification('المتصفح لا يدعم الوصول إلى الكاميرا', 'warning');
      }
    }

    // التقاط صورة من الكاميرا
    function captureImage() {
      const context = cameraCanvas.getContext('2d');
      cameraCanvas.width = cameraPreview.videoWidth;
      cameraCanvas.height = cameraPreview.videoHeight;
      context.drawImage(cameraPreview, 0, 0, cameraCanvas.width, cameraCanvas.height);
      
      // تحويل الصورة إلى base64
      const imageData = cameraCanvas.toDataURL('image/png');
      
      // عرض الصورة في المعاينة
      imagePreview.src = imageData;
      imagePreview.style.display = 'block';
      
      // حفظ الصورة في متغير مؤقت
      productImageInput.cameraImage = imageData;
      
      // إغلاق الكاميرا
      closeCamera();
      
      showNotification('تم التقاط الصورة بنجاح', 'success');
    }

    // إغلاق الكاميرا
    function closeCamera() {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
      }
      cameraModal.classList.remove('active');
    }

    // تبديل التبويبات
    function switchTab(e) {
      const tabId = e.currentTarget.getAttribute('data-tab');
      
      // إزالة النشاط من جميع الأيقونات والمحتويات
      navIcons.forEach(icon => icon.classList.remove('active'));
      tabContents.forEach(content => content.classList.remove('active'));
      
      // إضافة النشاط للأيقونة والمحتوى المحدد
      e.currentTarget.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    // تحديث قوائم الفئات
    function updateCategories() {
      // تحديث قائمة الفئات في نموذج الإضافة
      productCategoryInput.innerHTML = '';
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.id;
        option.textContent = category.name;
        productCategoryInput.appendChild(option);
      });
      
      // تحديث قائمة الفئات في التصفية
      categoryFilter.innerHTML = '<option value="all">جميع الفئات</option>';
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.id;
        option.textContent = category.name;
        categoryFilter.appendChild(option);
      });
    }

    // عرض الفئات في صفحة الإدارة
    function renderCategories() {
      categoriesList.innerHTML = '';
      
      if (categories.length === 0) {
        categoriesList.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-tags"></i>
            <h3>لا توجد فئات</h3>
            <p>ابدأ بإضافة فئة جديدة</p>
          </div>
        `;
        return;
      }
      
      categories.forEach(category => {
        const categoryCard = document.createElement('div');
        categoryCard.className = 'product-card';
        categoryCard.innerHTML = `
          <div class="product-image">
            ${category.image ? `<img src="${category.image}" style="width:100%; height:100%; object-fit:cover; border-radius:12px;" alt="${category.name}">` : 
            `<i class="fas fa-tag" style="font-size: 3.5rem;"></i>`}
          </div>
          <div class="product-name">${category.name}</div>
          <div class="product-meta">
            <div class="product-category">${category.productCount} منتج</div>
          </div>
          <div class="product-actions">
            <button onclick="editCategory('${category.id}')">
              <i class="fas fa-edit"></i> تعديل
            </button>
            <button onclick="deleteCategory('${category.id}')" class="btn-danger">
              <i class="fas fa-trash-alt"></i> حذف
            </button>
          </div>
        `;
        categoriesList.appendChild(categoryCard);
      });
    }

    // تحديث عدد المنتجات في كل فئة
    function updateProductCounts() {
      categories.forEach(category => {
        category.productCount = products.filter(p => p.category === category.id).length;
      });
      saveCategories();
      renderCategories();
    }

    // إضافة فئة جديدة
    function addCategory() {
      const newCategoryName = newCategoryNameInput.value.trim();
      if (!newCategoryName) {
        showNotification('يرجى إدخال اسم الفئة', 'warning');
        return;
      }
      
      if (categories.find(c => c.name === newCategoryName)) {
        showNotification('هذه الفئة موجودة مسبقاً', 'warning');
        return;
      }
      
      const file = categoryImageInput.files[0];
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const base64 = e.target.result;
          processCategorySave(newCategoryName, base64);
        };
        reader.readAsDataURL(file);
      } else if (categoryImageUrlInput.value.trim()) {
        // استخدام رابط الصورة
        processCategorySave(newCategoryName, categoryImageUrlInput.value.trim());
      } else {
        processCategorySave(newCategoryName, null);
      }
    }

    // معالجة حفظ الفئة
    function processCategorySave(name, image) {
      const category = {
        id: editingCategoryId || Date.now().toString(),
        name,
        image,
        productCount: 0
      };

      if (editingCategoryId) {
        // تعديل فئة موجودة
        const index = categories.findIndex(c => c.id === editingCategoryId);
        if (index !== -1) {
          // الاحتفاظ بالصورة القديمة إذا لم يتم تحميل صورة جديدة
          if (!image) {
            category.image = categories[index].image;
          }
          category.productCount = categories[index].productCount;
          categories[index] = category;
        }
        editingCategoryId = null;
        addCategoryBtn.innerHTML = '<i class="fas fa-plus"></i> إضافة الفئة';
        showNotification('تم تحديث الفئة بنجاح', 'success');
      } else {
        // إضافة فئة جديدة
        categories.push(category);
        showNotification('تم إضافة الفئة بنجاح', 'success');
      }

      saveCategories();
      updateCategories();
      resetCategoryForm();
      updateAppInfo();
      renderCategories();
    }

    // تعديل فئة
    function editCategory(id) {
      const category = categories.find(c => c.id === id);
      if (!category) return;

      newCategoryNameInput.value = category.name;
      
      if (category.image) {
        categoryImagePreview.src = category.image;
        categoryImagePreview.style.display = 'block';
      } else {
        categoryImagePreview.style.display = 'none';
      }

      editingCategoryId = id;
      addCategoryBtn.innerHTML = '<i class="fas fa-sync-alt"></i> تحديث الفئة';
      
      showNotification('يمكنك الآن تعديل الفئة', 'info');
    }

    // حذف فئة
    function deleteCategory(id) {
      const category = categories.find(c => c.id === id);
      if (!category) return;
      
      if (category.productCount > 0) {
        showNotification(`لا يمكن حذف الفئة لأنها تحتوي على ${category.productCount} منتج`, 'warning');
        return;
      }
      
      if (confirm(`هل أنت متأكد من حذف فئة "${category.name}"؟`)) {
        categories = categories.filter(c => c.id !== id);
        saveCategories();
        updateCategories();
        showNotification('تم حذف الفئة بنجاح', 'success');
        updateAppInfo();
        renderCategories();
      }
    }

    // معاينة صورة الفئة
    function previewCategoryImage() {
      const file = categoryImageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          categoryImagePreview.src = e.target.result;
          categoryImagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    // تحميل صورة الفئة من الرابط
    function loadCategoryImageFromUrl() {
      const imageUrl = categoryImageUrlInput.value.trim();
      if (!imageUrl) {
        showNotification('يرجى إدخال رابط الصورة', 'warning');
        return;
      }
      
      categoryImagePreview.src = imageUrl;
      categoryImagePreview.style.display = 'block';
      showNotification('تم تحميل الصورة من الرابط', 'success');
    }

    // إعادة تعيين نموذج الفئة
    function resetCategoryForm() {
      newCategoryNameInput.value = '';
      categoryImageInput.value = '';
      categoryImageUrlInput.value = '';
      categoryImagePreview.style.display = 'none';
    }

    // حفظ الفئات في LocalStorage
    function saveCategories() {
      localStorage.setItem('categories', JSON.stringify(categories));
    }

    // حفظ المنتج
    function saveProduct() {
      const name = productNameInput.value.trim();
      const category = productCategoryInput.value;
      const barcode = productBarcodeInput.value.trim();
      const file = productImageInput.files[0];

      if (!name) {
        showNotification('يرجى ملء جميع الحقول المطلوبة', 'warning');
        return;
      }

      // التحقق من وجود صورة من الكاميرا
      const cameraImage = productImageInput.cameraImage;
      const imageUrl = productImageUrlInput.value.trim();

      if (cameraImage) {
        processProductSave(name, category, barcode, cameraImage);
        productImageInput.cameraImage = null; // إعادة تعيين
      } else if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const base64 = e.target.result;
          processProductSave(name, category, barcode, base64);
        };
        reader.readAsDataURL(file);
      } else if (imageUrl) {
        processProductSave(name, category, barcode, imageUrl);
      } else {
        processProductSave(name, category, barcode, null);
      }
    }

    // معالجة حفظ المنتج
    function processProductSave(name, category, barcode, image) {
      const product = {
        id: editingId || Date.now().toString(),
        name,
        category,
        barcode,
        image: image,
        date: new Date().toISOString()
      };

      if (editingId) {
        // تعديل منتج موجود
        const index = products.findIndex(p => p.id === editingId);
        if (index !== -1) {
          // الاحتفاظ بالصورة القديمة إذا لم يتم تحميل صورة جديدة
          if (!image) {
            product.image = products[index].image;
          }
          products[index] = product;
        }
        editingId = null;
        saveProductBtn.innerHTML = '<i class="fas fa-save"></i> حفظ المنتج';
        showNotification('تم تحديث المنتج بنجاح', 'success');
      } else {
        // إضافة منتج جديد
        products.push(product);
        showNotification('تم إضافة المنتج بنجاح', 'success');
      }

      saveToLocalStorage();
      resetForm();
      renderProducts();
      renderRecentAddedProducts();
      updateProductCounts();
      updateAppInfo();
    }

    // عرض صورة المنتج قبل الحفظ
    function previewImage() {
      const file = productImageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    // تحميل صورة المنتج من الرابط
    function loadImageFromUrl() {
      const imageUrl = productImageUrlInput.value.trim();
      if (!imageUrl) {
        showNotification('يرجى إدخال رابط الصورة', 'warning');
        return;
      }
      
      imagePreview.src = imageUrl;
      imagePreview.style.display = 'block';
      showNotification('تم تحميل الصورة من الرابط', 'success');
    }

    // عرض المنتجات
    function renderProducts(filteredProducts = null) {
      const productsToRender = filteredProducts || sortProducts(products);
      
      if (productsToRender.length === 0) {
        productsContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-database"></i>
            <h3>لا توجد منتجات في قاعدة البيانات</h3>
            <p>ابدأ بإضافة منتج جديد</p>
          </div>
        `;
        return;
      }

      productsContainer.innerHTML = productsToRender.map(product => {
        const category = categories.find(c => c.id === product.category);
        const categoryName = category ? category.name : 'غير معروف';
        
        return `
        <div class="product-card">
          <div class="product-image" onclick="showProductDetails('${product.id}')">
            ${product.image ? `<img src="${product.image}" style="width:100%; height:100%; object-fit:cover; border-radius:12px;" alt="${product.name}">` : 
            `<i class="fas fa-box" style="font-size: 3.5rem;"></i>`}
          </div>
          <div class="product-name">${highlightSearchTerms(product.name)}</div>
          <div class="product-barcode">${product.barcode || 'غير محدد'}</div>
          <div class="product-meta">
            <div class="product-category">${categoryName}</div>
          </div>
          <div class="product-actions">
            <button onclick="showProductDetails('${product.id}')">
              <i class="fas fa-eye"></i> عرض
            </button>
            <button onclick="editProduct('${product.id}')">
              <i class="fas fa-edit"></i> تعديل
            </button>
            <button onclick="deleteProduct('${product.id}')" class="btn-danger">
              <i class="fas fa-trash-alt"></i> حذف
            </button>
          </div>
        </div>
      `}).join('');
    }

    // عرض المنتجات المضافة حديثاً
    function renderRecentAddedProducts() {
      const recentProducts = [...products]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 3);
      
      if (recentProducts.length === 0) {
        recentAddedProductsContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-box-open"></i>
            <h3>لا توجد منتجات مضافة بعد</h3>
            <p>ابدأ بإضافة منتج جديد</p>
          </div>
        `;
        return;
      }

      recentAddedProductsContainer.innerHTML = recentProducts.map(product => {
        const category = categories.find(c => c.id === product.category);
        const categoryName = category ? category.name : 'غير معروف';
        
        return `
        <div class="product-card" style="margin-bottom: 25px;" onclick="showProductDetails('${product.id}')">
          <div class="product-header" style="display: flex; align-items: center; gap: 18px; margin-bottom: 18px;">
            ${product.image ? `<img src="${product.image}" style="width:70px; height:70px; object-fit:cover; border-radius:12px;" alt="${product.name}">` : 
            `<div style="width:70px; height:70px; background: #f8f9fa; border-radius:12px; display:flex; align-items:center; justify-content:center;"><i class="fas fa-box"></i></div>`}
            <div>
              <div class="product-name" style="font-size: 1.2rem;">${product.name}</div>
              <div class="product-barcode" style="font-size: 1rem;">${product.barcode || 'غير محدد'}</div>
              <div class="product-category">${categoryName}</div>
            </div>
          </div>
        </div>
      `}).join('');
    }

    // ترتيب المنتجات
    function sortProducts(productsList) {
      const sortValue = sortBy.value;
      
      switch(sortValue) {
        case 'newest':
          return [...productsList].sort((a, b) => new Date(b.date) - new Date(a.date));
        case 'oldest':
          return [...productsList].sort((a, b) => new Date(a.date) - new Date(b.date));
        case 'name':
          return [...productsList].sort((a, b) => a.name.localeCompare(b.name));
        default:
          return productsList;
      }
    }

    // إضافة تمييز لكلمات البحث في النتائج
    function highlightSearchTerms(text) {
      const searchTerm = searchInput.value.trim();
      if (!searchTerm) return text;
      
      const regex = new RegExp(`(${searchTerm})`, 'gi');
      return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    // معالجة البحث - تم التصحيح
    function handleSearch() {
      // إلغاء المهلة السابقة إذا كانت موجودة
      if (searchTimeout) {
        clearTimeout(searchTimeout);
      }
      
      // تعيين مهلة جديدة للبحث (لتحسين الأداء)
      searchTimeout = setTimeout(() => {
        const searchTerm = searchInput.value.toLowerCase().trim();
        
        if (searchTerm) {
          // البحث الذكي - البحث في جميع الحقول
          const filtered = products.filter(p => 
            p.name.toLowerCase().includes(searchTerm) || 
            (p.barcode && p.barcode.toLowerCase().includes(searchTerm)) ||
            (categories.find(c => c.id === p.category)?.name.toLowerCase().includes(searchTerm))
          );
          
          // عرض نتائج البحث التلقائي
          renderSearchResults(filtered);
          searchResultsDropdown.classList.add('active');
          
          // عرض نتائج البحث في القائمة الرئيسية
          renderProducts(sortProducts(filtered));
        } else {
          // إخفاء نتائج البحث التلقائي إذا كان حقل البحث فارغاً
          searchResultsDropdown.classList.remove('active');
          // عرض جميع المنتجات
          renderProducts();
        }
      }, 300);
    }

    // تصفية المنتجات
    function filterProducts() {
      const searchTerm = searchInput.value.toLowerCase();
      const category = categoryFilter.value;

      let filtered = products;

      if (category !== 'all') {
        filtered = filtered.filter(p => p.category === category);
      }

      if (searchTerm) {
        filtered = filtered.filter(p => 
          p.name.toLowerCase().includes(searchTerm) || 
          (p.barcode && p.barcode.toLowerCase().includes(searchTerm)) ||
          (categories.find(c => c.id === p.category)?.name.toLowerCase().includes(searchTerm))
        );
      }

      renderProducts(sortProducts(filtered));
    }

    // تعديل منتج
    function editProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;

      productNameInput.value = product.name;
      productCategoryInput.value = product.category;
      productBarcodeInput.value = product.barcode || '';
      
      if (product.image) {
        imagePreview.src = product.image;
        imagePreview.style.display = 'block';
      } else {
        imagePreview.style.display = 'none';
      }

      editingId = id;
      saveProductBtn.innerHTML = '<i class="fas fa-sync-alt"></i> تحديث المنتج';
      productImageInput.value = ''; // إعادة تعيين اختيار الملف

      // التبديل إلى تبويب إضافة المنتج
      document.getElementById('nav-add-product').click();
      
      showNotification('يمكنك الآن تعديل المنتج', 'info');
    }

    // حذف منتج
    function deleteProduct(id) {
      if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
        products = products.filter(p => p.id !== id);
        saveToLocalStorage();
        renderProducts();
        renderRecentAddedProducts();
        updateProductCounts();
        updateAppInfo();
        showNotification('تم حذف المنتج بنجاح', 'success');
      }
    }

    // حفظ البيانات في LocalStorage
    function saveToLocalStorage() {
      localStorage.setItem('products', JSON.stringify(products));
      localStorage.setItem('categories', JSON.stringify(categories));
      localStorage.setItem('lastUpdate', new Date().toISOString());
    }

    // إعادة تعيين النموذج
    function resetForm() {
      productNameInput.value = '';
      productCategoryInput.value = categories[0] ? categories[0].id : '';
      productBarcodeInput.value = '';
      productImageInput.value = '';
      productImageUrlInput.value = '';
      imagePreview.style.display = 'none';
      productImageInput.cameraImage = null;
    }

    // تصدير البيانات مع حفظ في مجلد التطبيق
    function exportData() {
      const dataStr = JSON.stringify(products, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const url = URL.createObjectURL(dataBlob);
      const a = document.createElement('a');
      a.href = url;
      
      // استخدام اسم التطبيق في اسم الملف
      a.download = 'قاعدة_بيانات_المنتجات_' + new Date().toISOString().slice(0, 10) + '.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('تم تصدير قاعدة البيانات بنجاح', 'success');
    }

    // تحميل الإعدادات
    function loadSettings() {
      // تحديث نصوص الأزرار بناءً على الإعدادات
      updateSettingsButtons();
    }

    // تحديث نصوص أزرار الإعدادات
    function updateSettingsButtons() {
      darkModeToggle.innerHTML = appSettings.darkMode ? 
        '<i class="fas fa-sun"></i> إلغاء الوضع الليلي' : 
        '<i class="fas fa-moon"></i> تفعيل الوضع الليلي';
        
      notificationsToggle.innerHTML = appSettings.notifications ? 
        '<i class="fas fa-bell-slash"></i> إلغاء الإشعارات' : 
        '<i class="fas fa-bell"></i> تفعيل الإشعارات';
        
      autoBackupToggle.innerHTML = appSettings.autoBackup ? 
        '<i class="fas fa-times-circle"></i> إلغاء النسخ التلقائي' : 
        '<i class="fas fa-save"></i> تفعيل النسخ التلقائي';
    }

    // تفعيل/إلغاء الوضع الليلي
    function toggleDarkMode() {
      appSettings.darkMode = !appSettings.darkMode;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
      updateSettingsButtons();
      
      // تطبيق الوضع الليلي
      document.body.classList.toggle('dark-mode', appSettings.darkMode);
      
      showNotification(appSettings.darkMode ? 'تم تفعيل الوضع الليلي' : 'تم إلغاء الوضع الليلي', 'success');
    }

    // تفعيل/إلغاء الإشعارات
    function toggleNotifications() {
      appSettings.notifications = !appSettings.notifications;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
      updateSettingsButtons();
      showNotification(appSettings.notifications ? 'تم تفعيل الإشعارات' : 'تم إلغاء الإشعارات', 'success');
    }

    // تفعيل/إلغاء النسخ التلقائي
    function toggleAutoBackup() {
      appSettings.autoBackup = !appSettings.autoBackup;
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
      updateSettingsButtons();
      showNotification(appSettings.autoBackup ? 'تم تفعيل النسخ التلقائي' : 'تم إلغاء النسخ التلقائي', 'success');
    }

    // تصدير جميع البيانات مع حفظ في مجلد التطبيق
    function exportAllData() {
      const allData = {
        products: products,
        categories: categories,
        settings: appSettings,
        exportDate: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(allData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const url = URL.createObjectURL(dataBlob);
      const a = document.createElement('a');
      a.href = url;
      
      // استخدام اسم التطبيق في اسم الملف
      a.download = 'قاعدة_بيانات_المنتجات_' + new Date().toISOString().slice(0, 10) + '.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('تم تصدير جميع البيانات بنجاح', 'success');
    }

    // استيراد جميع البيانات
    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedData = JSON.parse(e.target.result);
          
          if (confirm('سيتم استبدال جميع البيانات الحالية. هل تريد المتابعة؟')) {
            if (importedData.products) products = importedData.products;
            if (importedData.categories) categories = importedData.categories;
            if (importedData.settings) appSettings = importedData.settings;
            
            saveToLocalStorage();
            saveCategories();
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
            
            initApp();
            showNotification('تم استيراد جميع البيانات بنجاح', 'success');
          }
        } catch (error) {
          showNotification('خطأ في قراءة الملف. تأكد من أن الملف صالح.', 'warning');
        }
        
        // إعادة تعيين حقل الملف
        event.target.value = '';
      };
      reader.readAsText(file);
    }

    // عرض نافذة حذف جميع البيانات
    function showDeleteAllModal() {
      deleteAllModal.classList.add('active');
      adminPasswordInput.value = '';
    }

    // تأكيد حذف جميع البيانات
    function confirmDeleteAll() {
      const password = adminPasswordInput.value.trim();
      
      if (password !== 'admin') {
        showNotification('كلمة المرور غير صحيحة', 'warning');
        return;
      }
      
      if (confirm('هل أنت متأكد من حذف جميع البيانات؟ لا يمكن التراجع عن هذا الإجراء.')) {
        products = [];
        categories = [];
        
        saveToLocalStorage();
        saveCategories();
        initApp();
        deleteAllModal.classList.remove('active');
        showNotification('تم حذف جميع البيانات بنجاح', 'success');
      }
    }

    // إلغاء حذف جميع البيانات
    function cancelDeleteAll() {
      deleteAllModal.classList.remove('active');
    }

    // تحديث معلومات التطبيق
    function updateAppInfo() {
      const productsSize = JSON.stringify(products).length;
      const categoriesSize = JSON.stringify(categories).length;
      const settingsSize = JSON.stringify(appSettings).length;
      const totalSize = productsSize + categoriesSize + settingsSize;
      
      totalDataSizeEl.textContent = `${(totalSize / 1024).toFixed(2)} KB`;
    }

    // عرض الإشعارات - تم التصحيح
    function showNotification(message, type = 'info') {
      // التحقق من تفعيل الإشعارات في الإعدادات
      if (!appSettings.notifications && type !== 'warning') return;
      
      notificationText.textContent = message;
      notification.className = 'notification';
      
      // إضافة أيقونة ولون حسب نوع الإشعار
      let iconClass = 'fas fa-info-circle';
      
      if (type === 'success') {
        notification.classList.add('success');
        iconClass = 'fas fa-check-circle';
      } else if (type === 'warning') {
        notification.classList.add('warning');
        iconClass = 'fas fa-exclamation-triangle';
      } else {
        notification.classList.add('info');
        iconClass = 'fas fa-info-circle';
      }
      
      notification.innerHTML = `<i class="${iconClass}"></i> <span id="notification-text">${message}</span>`;
      
      notification.classList.add('show');
      
      // إخفاء الإشعار بعد 3 ثوان
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // جعل الدوال متاحة عالمياً لاستدعائها من الأزرار في HTML
    window.showProductDetails = showProductDetails;
    window.editProduct = editProduct;
    window.deleteProduct = deleteProduct;
    window.editCategory = editCategory;
    window.deleteCategory = deleteCategory;
  </script>
</body>
</html>